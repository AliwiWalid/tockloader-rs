name: Deploy mdBook to GitHub Pages (Branch Deployment)

on:
  push:
    branches:
      - main # Deploy the main site when pushing to 'main'
      # - preview-test # You can add this if you want to deploy from 'preview-test' as well

permissions:
  contents: write # This is crucial: the workflow needs write access to push to the gh-pages branch

jobs:
  deploy-book:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install mdBook if missing
        run: |
          if ! command -v mdbook >/dev/null; then
            echo "mdbook not found, installing..."
            cargo install mdbook --version "^0.4"
          else
            echo "mdbook is already installed"
          fi

      - name: Build mdBook
        run: mdbook build docs # This builds your book into 'docs/book'

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4 # Use this action for direct branch deployment
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./docs/book # The directory containing your built book files
          publish_branch: gh-pages # The branch where your GitHub Pages content will live
          # The default 'gh-pages' branch is commonly used for this.
          # It will be created if it doesn't exist.